# 关于文档

## 文档本身

针对文档本身的一些约束组成了业务逻辑，因此我们计划将文档作为领域模型。

文档在一个单独的 Context 内，与其他的业务模型没有联系，所以可以单独设计。

## 文档读取

一种网页端读取给定目录文档的功能。

### 为什么有这个

考虑到部分用户可能有点难以查阅在不同目录下的文档，故把其嵌入了 WebUI 中。

### 设计

在浏览器中的目录：

- `/docs` 所有文档的索引
- `/docs/<RepoName:Optional>/<lang:Optional>/Any`
  - `<RepoName>` 是仓库的目录
  - `<lang>` 附带语言的目录（在这多语言目录下很有用）
  - 其中 `Any` 是文档相对于**其**根目录的相对目录
    - e.g. `<RepoName>` 下的 `/a/b/c.md` 会变成 `/docs/<RepoName>/a/b/c` ，其中的 `a/b/c` 就是相对地址

例子如下：

- 单一仓库单一语言
  - 在本地：`/docs/example/example.md`
  - 在浏览器：`/docs/example/example`
- 多仓库多语言
  - 本地 `<Repo1Path>/Repo1` 下有文档，其中我们要读取 `/test/q.md` 以及 `/test/a.zh.md`
  - 在浏览器上为 `/docs/Repo1/en/test/q` 以及 `/docs/Repo1/cmn/test/a`

对文档的一些约束：参见[约定](/docs/development/spec.cmn-Hans.md)。

### 如何实现

大致分为两步：

- 先从系统目录中读取文档目录以及**所有的**文档本体（不包括 `/assets` 下的内容）至数据库并建立索引
  - 读取
  - 解析
- 到时按需从数据库/系统目录中装载对应内容至浏览器

也就是需要两个 `Adapter` 来实现 `Repository`：

- `DAO` 与数据库
- `FileLoader` 与文件

在实现中，我们将其变成针对 `DocRepo/DocMetaRepo` 的抽象。

#### 为什么要有单独的 `Metadata` ？

考虑到某些文件内容过大，因此不想读取文件本体。

#### 解析部分的处理

总的来说，包括以下流程：

- 正文
  - 将文本以标题/小标题为主分割开
    - 标题转换为特定的 `id`
  - 移除 `TOC` 的部分
  - 将链接进行处理
    - 文档/媒体资料的文件目录 |某种规则> 路由
    - 对标题的链接 |某种规则> 对应 `id`
- 目录
  - 相对根目录的文件位置 |某种规则> 路由
